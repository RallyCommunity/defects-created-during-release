<!DOCTYPE html>
<html>
<head>
    <title>Defects Created After Start of Release</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:{html:'<a href="https://help.rallydev.com/apps/2.0rc3/doc/">App SDK 2.0rc3 Docs</a>'},launch:function(){var rComboBox=Ext.create("Rally.ui.combobox.ReleaseComboBox",{listeners:{ready:function(combobox){this._getData(combobox.getRecord())},select:function(combobox){this._getData(combobox.getRecord())},scope:this}});this.add(rComboBox)},_getData:function(release){var project=this.getContext().getProject(),projectRef=project._ref;this._projectOid=project.ObjectID,console.log(project);var releaseStartDate=release.get("ReleaseStartDate"),releaseStartDateISO=Rally.util.DateTime.toIsoString(releaseStartDate,!0),releaseDate=release.get("ReleaseDate"),releaseDateISO=Rally.util.DateTime.toIsoString(releaseDate,!0),myStore=Ext.create("Rally.data.wsapi.Store",{model:"Defect",autoLoad:!0,fetch:["Name","State","CreationDate"],filters:[{property:"CreationDate",operator:">=",value:releaseStartDateISO},{property:"CreationDate",operator:"<=",value:releaseDateISO},{property:"Project",value:projectRef}],listeners:{load:function(store,records,success){console.log("loaded %i records",records.length),this._updateGrid(myStore)},scope:this}})},_updateGrid:function(myStore){void 0===this._myGrid?this._createGrid(myStore):this._myGrid.reconfigure(myStore)},_createGrid:function(myStore){var that=this;this._myGrid=Ext.create("Ext.grid.Panel",{title:"Defects created after the start of Release",store:myStore,columns:[{text:"Name",dataIndex:"Name",flex:1,renderer:function(val,meta,record){return'<a href="https://rally1.rallydev.com/#/'+that._projectOid+"/detail/iteration/"+record.get("ObjectID")+'" target="_blank">'+record.get("Name")+"</a>"}},{text:"CreationDate",dataIndex:"CreationDate",flex:2},{text:"State",dataIndex:"State",flex:2}],height:400}),this.add(this._myGrid)}});

            Rally.launchApp('CustomApp', {
                name:"Defects Created After Start of Release",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
